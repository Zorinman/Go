# Go Modules 与 GOPATH 模式对比

| 特性                | Go Modules (新)                          | GOPATH (旧)                          |
|---------------------|-----------------------------------------|--------------------------------------|
| **启用方式**        | `GO111MODULE=on` (Go 1.16+ 默认)        | `GO111MODULE=off`                    |
| **项目路径**        | 可放在任意位置                          | 必须放在 `$GOPATH/src` 下             |
| **依赖管理**        | 通过 `go.mod` 和 `go.sum` 文件管理       | 无版本控制，直接使用 `$GOPATH/src` 代码 |
| **依赖存储位置**    | `$GOPATH/pkg/mod` (全局缓存)            | `$GOPATH/src` (直接修改代码)          |
| **版本控制**        | 支持语义化版本 (如 `v1.2.3`)            | 仅使用代码库最新版本                 |
| **隔离性**          | 每个项目独立依赖                        | 所有项目共享依赖，易冲突             |
| **初始化命令**      | `go mod init <module-path>`             | 无需初始化，直接创建目录             |
| **添加依赖**        | `go get github.com/foo/bar@v1.2.3`      | `go get github.com/foo/bar`          |
| **更新依赖**        | `go get -u github.com/foo/bar`          | 直接覆盖 `$GOPATH/src` 下的代码       |
| **清理未用依赖**    | `go mod tidy` 自动处理                  | 需手动删除                           |
| **构建确定性**      | 通过 `go.sum` 保证依赖一致性            | 依赖本地代码状态，不可靠             |
| **vendor 目录**     | 可选 (`go mod vendor`)                  | 必须手动维护                         |
| **代理支持**        | 支持 (`GOPROXY=https://goproxy.cn`)     | 无原生支持                           |
| **工具安装路径**    | `$GOPATH/bin` (仍保留)                  | `$GOPATH/bin`                        |
| **跨平台构建**      | 自动识别平台特定文件                    | 需手动管理                           |

# Go Modules 模式下 GOPATH 的定位变化

## 1. GOPATH 的剩余作用

在 `GO111MODULE=on` 模式下，`GOPATH` 仍保留以下功能：

| 作用领域           | 具体表现                                                                 | 典型路径示例                     |
|--------------------|--------------------------------------------------------------------------|----------------------------------|
| **全局工具安装**   | 通过 `go install` 安装的二进制工具默认存放位置                           | `$GOPATH/bin/gopls`             |
| **模块缓存存储**   | 所有下载的依赖包缓存目录（不可手动修改）                                 | `$GOPATH/pkg/mod/github.com/...` |
| **go install 行为** | 安装非模块化包时仍会使用 `$GOPATH/src`                                   | `$GOPATH/src/legacy-package`    |
| **IDE 兼容性**     | 部分旧版 IDE 插件可能仍依赖 `GOPATH` 解析路径                           | -                                |

## 2. 不再依赖 GOPATH 的核心功能

以下是 Go Modules 中已解耦的功能：

| 旧模式依赖项        | Go Modules 的替代方案                                                  | 关键差异点                     |
|---------------------|-----------------------------------------------------------------------|-------------------------------|
| **项目存放位置**    | 项目可存在于任意路径（如 `~/dev/my-project`）                         | 彻底解除路径耦合               |
| **依赖获取方式**    | 通过 `go.mod` 声明依赖，从镜像源下载到 `pkg/mod`                      | 版本化、隔离式存储             |
| **构建依赖解析**    | 优先使用 `go.mod` 中的版本声明                                        | 不再搜索 `$GOPATH/src`         |
| **第三方库修改**    | 通过 `replace` 指令本地替换（不污染全局空间）                         | 修改仅对当前模块生效           |
| **跨项目依赖共享**  | 每个项目独立维护依赖版本                                              | 避免 "依赖地狱"                |

### 补充说明
- **缓存清理**：可通过 `go clean -modcache` 清理 `$GOPATH/pkg/mod`
- **路径覆盖**：仍可通过设置 `GOPATH` 环境变量改变默认位置，但不推荐

> **注**：从 Go 1.16 开始，Modules 已成为默认模式，GOPATH 模式仅用于兼容旧项目。

